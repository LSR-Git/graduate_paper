# Covasim 人口基本属性说明

## 必需的基本属性

根据 Covasim 源代码，创建人口字典（`popdict`）时，**只有三个属性是必需的**：

### 1. `uid` (唯一标识符)
- **类型**: 整数数组 (`dtype=cv.default_int`)
- **说明**: 每个人的唯一标识符，通常是连续的整数 `[0, 1, 2, ..., pop_size-1]`
- **示例**: `np.arange(pop_size, dtype=cv.default_int)`

### 2. `age` (年龄)
- **类型**: 浮点数数组 (`dtype=float`)
- **说明**: 每个人的年龄（单位：年）
- **示例**: `np.random.uniform(18, 65, pop_size)`

### 3. `sex` (性别)
- **类型**: 整数数组 (`dtype=int`)
- **说明**: 每个人的性别（当前版本未在模拟中使用，但必需）
- **示例**: `np.random.binomial(1, 0.5, pop_size)`

## 源代码位置

这些必需属性的定义在以下位置：

### 1. 验证函数：`covasim/population.py`
```python
# 第104-141行：validate_popdict 函数
def validate_popdict(popdict, pars, verbose=True):
    # ...
    required_keys = ['uid', 'age', 'sex']  # 第118行
    # ...
```

### 2. 创建函数：`covasim/population.py`
```python
# 第144-227行：make_randpop 函数
def make_randpop(pars, ...):
    '''
    This function returns a "popdict" dictionary, which has the following (required) keys:
        - uid: an array of (usually consecutive) integers of length N
        - age: an array of floats of length N, the age in years of each agent
        - sex: an array of integers of length N (not currently used, so does not have to be binary)
        - contacts: list of length N listing the contacts
        - layer_keys: a list of strings representing the different contact layers
    '''
    # ...
    popdict['uid'] = uids      # 第209行
    popdict['age'] = ages      # 第210行
    popdict['sex'] = sexes      # 第211行
    # ...
```

### 3. People 对象创建：`covasim/population.py`
```python
# 第97行：创建 People 对象时只使用这四个参数
people = cvppl.People(sim.pars, 
                      uid=popdict['uid'], 
                      age=popdict['age'], 
                      sex=popdict['sex'], 
                      contacts=popdict['contacts'])
```

## 通常需要的属性（虽然不是必需的）

### 4. `contacts` (接触网络)
- **类型**: `cv.Contacts` 对象或字典
- **说明**: 定义人员之间的接触关系
- **注意**: 如果没有提供，系统会发出警告，但不会报错

### 5. `layer_keys` (层键列表)
- **类型**: 字符串列表
- **说明**: 定义接触网络的层名称（如 `['h', 's', 'w', 'c']` 或自定义层名）

## 自定义属性

除了必需属性外，你可以添加任何自定义属性，例如：

- `country`: 国家/地区
- `health_status`: 健康状况
- `vaccination_status`: 疫苗接种状态
- 等等...

**注意**：自定义属性不会在创建 `People` 对象时自动传递，需要手动添加到 `sim.people` 对象中：

```python
# 创建 popdict 时添加自定义属性
popdict = {
    'uid': uids,
    'age': ages,
    'sex': sexes,
    'country': countries,  # 自定义属性
    'contacts': contacts,
    'layer_keys': layer_keys
}

# 初始化后，手动添加到 people 对象
sim.initialize()
sim.people.country = popdict['country']  # 手动添加
```

## 完整示例

```python
import numpy as np
import covasim as cv

pop_size = 100

# 必需的基本属性（这三个是必须的）
uids = np.arange(pop_size, dtype=cv.default_int)
ages = np.random.uniform(18, 65, pop_size)
sexes = np.random.binomial(1, 0.5, pop_size)

# 创建接触网络
contacts = cv.Contacts()
# ... 添加层 ...

# 创建人口字典
popdict = {
    'uid': uids,        # 必需
    'age': ages,        # 必需
    'sex': sexes,       # 必需
    'contacts': contacts,  # 通常需要
    'layer_keys': ['home', 'work'],  # 通常需要
    
    # 自定义属性（可选）
    'country': np.random.choice(['A', 'B'], pop_size),
    'health_status': np.random.binomial(1, 0.2, pop_size),
}

# 使用人口字典
sim = cv.Sim(pop_size=pop_size, n_days=90)
sim.popdict = popdict
sim.reset_layer_pars()
sim.initialize()

# 手动添加自定义属性到 people 对象
sim.people.country = popdict['country']
sim.people.health_status = popdict['health_status']
```

## 总结

- **必需属性**：只有 `uid`, `age`, `sex` 三个
- **通常需要**：`contacts`, `layer_keys`
- **自定义属性**：可以添加任意属性，但需要手动添加到 `sim.people` 对象中
- **参考位置**：`covasim/population.py` 第118行和第97行
