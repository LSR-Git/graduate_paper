# 自定义人员传播参数说明

在Covasim中，可以通过修改个人的传播参数来控制疾病的传播动态。主要有两个关键参数：

## 关键参数

### 1. `rel_sus` (相对易感性)
- **含义**：控制个人被感染的概率
- **默认值**：基于年龄，通常在0.5-2.0之间
- **设置范围**：
  - `0.0` = 完全免疫（不会被感染）
  - `1.0` = 正常易感性
  - `>1.0` = 更容易被感染
  - `<1.0` = 更不容易被感染

### 2. `rel_trans` (相对传播性)
- **含义**：控制个人感染他人的概率
- **默认值**：基于年龄和病毒载量分布
- **设置范围**：
  - `0.0` = 完全不会传播（即使感染了）
  - `1.0` = 正常传播性
  - `>1.0` = 传播能力更强
  - `<1.0` = 传播能力较弱

## 使用方法

### 方法1：在初始化后、运行前设置（推荐）

```python
import numpy as np
import covasim as cv
import ContactNetwork
import Enums

# 创建自定义人口
custom_config = {
    'country': {
        'network_type': Enums.NetWorkType.scale_free.name,
        'm_connections': 3,
        'beta': 0.3,
    }   
}

pop_size = 100

# 定义国家配置（比例总和必须等于1.0）
countries_config = {
    'A': 0.6,  # 60%
    'B': 0.4   # 40%
}

custom_popdict, custom_keys = ContactNetwork.create_custom_population(pop_size, custom_config, countries_config)

# 创建并初始化模拟
sim = cv.Sim(pop_size=pop_size, n_days=90)
sim.popdict = custom_popdict
sim.reset_layer_pars()
sim.initialize()  # 重要：必须先初始化

# 现在可以设置传播参数了

# 示例1：根据年龄设置
young = sim.people.age < 30
sim.people.rel_sus[young] = 1.5    # 年轻人易感性高
sim.people.rel_trans[young] = 1.2  # 年轻人传播性强

old = sim.people.age >= 50
sim.people.rel_sus[old] = 1.8      # 老年人易感性高
sim.people.rel_trans[old] = 0.8     # 但传播性低

# 示例2：根据自定义属性设置
sim.people.country = custom_popdict['country']  # 先添加属性
country_A = sim.people.country == 'A'
sim.people.rel_sus[country_A] = 1.3  # 国家A易感性高

# 示例3：随机设置（模拟个体差异）
sim.people.rel_sus = np.random.uniform(0.5, 1.5, pop_size)
sim.people.rel_trans = np.random.uniform(0.8, 1.2, pop_size)

# 运行模拟
sim.run()
```

### 方法2：通过干预措施动态设置

```python
def dynamic_transmission(sim):
    '''在模拟运行过程中动态修改传播参数'''
    # 第30天：降低年轻人的易感性（例如：开始接种疫苗）
    if sim.t == sim.day(30):
        young = sim.people.age < 30
        sim.people.rel_sus[young] *= 0.3  # 降低70%
    
    # 第60天：降低老年人的传播性
    if sim.t == sim.day(60):
        old = sim.people.age >= 50
        sim.people.rel_trans[old] *= 0.5  # 降低50%

sim = cv.Sim(pop_size=100, n_days=90, interventions=dynamic_transmission)
sim.popdict = custom_popdict
sim.reset_layer_pars()
sim.initialize()
sim.run()
```

## 常见应用场景

### 场景1：年龄相关的传播差异
```python
# 年轻人：易感性高，传播性强
young = sim.people.age < 30
sim.people.rel_sus[young] = 1.5
sim.people.rel_trans[young] = 1.2

# 中年人：正常
middle = (sim.people.age >= 30) & (sim.people.age < 50)
sim.people.rel_sus[middle] = 1.0
sim.people.rel_trans[middle] = 1.0

# 老年人：易感性高，但传播性低
old = sim.people.age >= 50
sim.people.rel_sus[old] = 1.8
sim.people.rel_trans[old] = 0.8
```

### 场景2：地区/国家差异
```python
# 添加国家属性
sim.people.country = custom_popdict['country']

# 不同国家设置不同的易感性
country_A = sim.people.country == 'A'
country_B = sim.people.country == 'B'

sim.people.rel_sus[country_A] = 1.3  # 国家A：易感性高
sim.people.rel_sus[country_B] = 0.7  # 国家B：易感性低（更好的防护）
```

### 场景3：健康状况差异
```python
# 假设有基础疾病的人易感性和传播性都更高
health_issue = sim.people.health_status == 1
sim.people.rel_sus[health_issue] *= 1.5   # 易感性增加50%
sim.people.rel_trans[health_issue] *= 1.3  # 传播性增加30%
```

### 场景4：模拟疫苗接种效果
```python
# 接种疫苗后降低易感性
vaccinated = sim.people.vaccinated
sim.people.rel_sus[vaccinated] = 0.2  # 降低80%的易感性
```

## 注意事项

1. **必须在 `sim.initialize()` 之后设置**：传播参数在初始化时会被设置为默认值，所以必须在初始化后才能修改。

2. **参数是数组**：`rel_sus` 和 `rel_trans` 是长度为 `pop_size` 的数组，每个元素对应一个人。

3. **可以使用布尔索引**：可以使用布尔数组来选择特定的人群，例如 `sim.people.rel_sus[young] = 1.5`。

4. **可以动态修改**：在模拟运行过程中（通过干预措施）可以动态修改这些参数。

5. **默认值会被覆盖**：如果设置了自定义值，会完全覆盖默认的基于年龄的值。

## 完整示例

参考以下文件查看完整示例：
- `custom_transmission_params.py` - 详细演示所有方法
- `mytest_with_transmission.py` - 简洁的使用示例
